<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wasm experiments</title>
</head>
<body>
<div id="log" class="log"></div>
<pre style="color:#d1d1d1;background:#000000;">

<span style="color:#e66170; font-weight:bold; ">const</span> wasm_url <span style="color:#d2cd86; ">=</span> <span style="color:#02d045; ">"</span><span style="color:#00c4c4; ">example.wasm</span><span style="color:#02d045; ">"</span><span style="color:#b060b0; ">;</span>

<span style="color:#e66170; font-weight:bold; ">const</span> importObj <span style="color:#d2cd86; ">=</span> <span style="color:#b060b0; ">{</span>
    module<span style="color:#b060b0; ">:</span> <span style="color:#b060b0; ">{</span><span style="color:#b060b0; ">}</span><span style="color:#d2cd86; ">,</span>
    env<span style="color:#b060b0; ">:</span> <span style="color:#b060b0; ">{</span>
        _Znaj<span style="color:#b060b0; ">:</span> <span style="color:#d2cd86; ">(</span>x<span style="color:#d2cd86; ">)</span> <span style="color:#d2cd86; ">=</span><span style="color:#d2cd86; ">></span> <span style="color:#b060b0; ">{</span>
            <span style="color:#e66170; font-weight:bold; ">return</span> <span style="color:#008c00; ">120</span><span style="color:#b060b0; ">;</span>
        <span style="color:#b060b0; ">}</span>
    <span style="color:#b060b0; ">}</span>
<span style="color:#b060b0; ">}</span><span style="color:#b060b0; ">;</span>

WebAssembly<span style="color:#d2cd86; ">.</span>instantiateStreaming<span style="color:#d2cd86; ">(</span>fetch<span style="color:#d2cd86; ">(</span>wasm_url<span style="color:#d2cd86; ">)</span><span style="color:#d2cd86; ">,</span> importObj<span style="color:#d2cd86; ">)</span>
    <span style="color:#d2cd86; ">.</span>then<span style="color:#d2cd86; ">(</span>res <span style="color:#d2cd86; ">=</span><span style="color:#d2cd86; ">></span> <span style="color:#b060b0; ">{</span>
        <span style="color:#e66170; font-weight:bold; ">const</span> arr <span style="color:#d2cd86; ">=</span> <span style="color:#d2cd86; ">[</span><span style="color:#008c00; ">1</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">2</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">3</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">4</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">5</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">6</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">7</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">8</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">9</span><span style="color:#d2cd86; ">,</span><span style="color:#008c00; ">10</span><span style="color:#d2cd86; ">]</span><span style="color:#b060b0; ">;</span>
        <span style="color:#e66170; font-weight:bold; ">let</span> typed_arr <span style="color:#d2cd86; ">=</span> <span style="color:#e66170; font-weight:bold; ">new</span> Int32Array<span style="color:#d2cd86; ">(</span>res<span style="color:#d2cd86; ">.</span>instance<span style="color:#d2cd86; ">.</span>exports<span style="color:#d2cd86; ">.</span>memory<span style="color:#d2cd86; ">.</span>buffer<span style="color:#d2cd86; ">,</span> <span style="color:#008c00; ">0</span><span style="color:#d2cd86; ">,</span> arr<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">length</span><span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>
        typed_arr<span style="color:#d2cd86; ">.</span>set<span style="color:#d2cd86; ">(</span>arr<span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>
        logger<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">log</span><span style="color:#d2cd86; ">(</span>typed_arr<span style="color:#d2cd86; ">,</span> <span style="color:#02d045; ">'</span><span style="color:#00c4c4; ">Типизированный маccив</span><span style="color:#02d045; ">'</span><span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>
        logger<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">log</span><span style="color:#d2cd86; ">(</span>res<span style="color:#d2cd86; ">.</span>instance<span style="color:#d2cd86; ">.</span>exports<span style="color:#d2cd86; ">.</span>_sum<span style="color:#d2cd86; ">(</span><span style="color:#008c00; ">0</span><span style="color:#d2cd86; ">,</span> typed_arr<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">length</span><span style="color:#d2cd86; ">)</span><span style="color:#d2cd86; ">,</span> <span style="color:#02d045; ">'</span><span style="color:#00c4c4; ">Сумма его элементов</span><span style="color:#02d045; ">'</span><span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>

        <span style="color:#e66170; font-weight:bold; ">const</span> offset <span style="color:#d2cd86; ">=</span> res<span style="color:#d2cd86; ">.</span>instance<span style="color:#d2cd86; ">.</span>exports<span style="color:#d2cd86; ">.</span>_duplicate_arr<span style="color:#d2cd86; ">(</span><span style="color:#008c00; ">0</span><span style="color:#d2cd86; ">,</span> typed_arr<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">length</span><span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>
        typed_arr <span style="color:#d2cd86; ">=</span> <span style="color:#e66170; font-weight:bold; ">new</span> Int32Array<span style="color:#d2cd86; ">(</span>res<span style="color:#d2cd86; ">.</span>instance<span style="color:#d2cd86; ">.</span>exports<span style="color:#d2cd86; ">.</span>memory<span style="color:#d2cd86; ">.</span>buffer<span style="color:#d2cd86; ">,</span> offset<span style="color:#d2cd86; ">,</span> typed_arr<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">length</span> <span style="color:#d2cd86; ">*</span> <span style="color:#008c00; ">2</span><span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>
        logger<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">log</span><span style="color:#d2cd86; ">(</span>typed_arr<span style="color:#d2cd86; ">,</span> <span style="color:#02d045; ">'</span><span style="color:#00c4c4; ">Новый массив возвращенный из C++ функции</span><span style="color:#02d045; ">'</span><span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>
        logger<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">log</span><span style="color:#d2cd86; ">(</span>res<span style="color:#d2cd86; ">.</span>instance<span style="color:#d2cd86; ">.</span>exports<span style="color:#d2cd86; ">.</span>_sum<span style="color:#d2cd86; ">(</span>offset<span style="color:#d2cd86; ">,</span> typed_arr<span style="color:#d2cd86; ">.</span><span style="color:#e66170; font-weight:bold; ">length</span><span style="color:#d2cd86; ">)</span><span style="color:#d2cd86; ">,</span> <span style="color:#02d045; ">'</span><span style="color:#00c4c4; ">Сумма его элементов</span><span style="color:#02d045; ">'</span><span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>
    <span style="color:#b060b0; ">}</span><span style="color:#d2cd86; ">)</span><span style="color:#b060b0; ">;</span>

</pre>
<!--Created using ToHtml.com on 2020-11-07 10:44:34 UTC -->
<script id="wasm" src="test.c526cdb9.wasm" type="application/wasm"></script>
<script src="src.e31bb0bc.js"></script>
</body>
</html>